{
  "workflow": {
    "unique_name": "definition_workflow_01OD1PCL0RXV10LyYf5QU9kVYA888BhHJR6",
    "name": "Ignore Anomaly on Helios",
    "title": "Ignore Anomaly on Helios",
    "type": "generic.workflow",
    "base_type": "workflow",
    "variables": [
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "observable_type",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01OD1S4OPBM761m5Yk499Hwq2h6O5uOn0tx",
        "object_type": "variable_workflow"
      },
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "observable_value",
          "type": "datatype.string",
          "is_required": false,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_01OD1SN9NY7FN7XM9qE2366Epc9DOwkVskF",
        "object_type": "variable_workflow"
      }
    ],
    "properties": {
      "atomic": {
        "is_atomic": false
      },
      "delete_workflow_instance": false,
      "display_name": "Ignore Anomaly on Helios",
      "runtime_user": {
        "override_target_runtime_user": false,
        "specify_on_workflow_start": false,
        "target_default": true
      },
      "target": {
        "execute_on_target_group": false,
        "execute_on_workflow_target": false,
        "no_target": true,
        "specify_on_workflow_start": false
      }
    },
    "object_type": "definition_workflow",
    "actions": [
      {
        "unique_name": "definition_activity_01OD1PGJBXHNP0wzI1Vj9O2sj5hhTCD6f35",
        "name": "Execute Python Script",
        "title": "Ignore Anomaly on Helios",
        "type": "python3.script",
        "base_type": "activity",
        "properties": {
          "action_timeout": 180,
          "continue_on_failure": false,
          "display_name": "Ignore Anomaly on Helios",
          "script": "'''\nSecureX orchestration workflow python script used to ignore anomalous object on Helios\nScript usage:\npython ignore_object_anomaly_alert.py \u003chelios_api_key\u003e \u003cobject\u003e\nhelios_api_key: Cohesity Helios API key\nobject: Anomalous object name\n'''\n\nimport argparse\nimport requests\nimport sys\n\n\ndef get_property_dict(property_list):\n    '''\n    get property dictionary from list of property dicts\n    with keys, values\n    :param property_list:\n    :return:\n    '''\n    property_dict = {}\n    for property in property_list:\n        property_dict[property['key']] = property['value']\n    return property_dict\n\n\ndef get_ransomware_alert_id(args):\n    '''\n    get ransomware alert id from Helios for the given\n    anomalous object\n    :param args:\n    :return:\n    '''\n    try:\n        alert_id = ''\n        url = 'https://helios.cohesity.com/mcm/alerts?' \\\n              'alertCategoryList=kSecurity\u0026alertStateList=kOpen'\n        params = {\n            \"maxAlerts\": 1000,\n            \"alertCategoryList\": \"kSecurity\",\n            \"alertStateList\": \"kOpen\",\n            \"_includeTenantInfo\": True\n        }\n        headers = {'Content-Type': 'application/json',\n                   'apiKey': args.helios_api_key}\n        response = requests.get(url, headers=headers, params=params, verify=False)\n        if response.status_code != 200:\n            raise Exception(str(response.json()))\n        for alert in response.json():\n            if alert['severity'] == 'kCritical' and alert['alertState'] == 'kOpen' and \\\n                    alert['alertCode'] == 'CE01516011':\n                property_dict = get_property_dict(alert['propertyList'])\n                if property_dict.get('object', \"\") == args.object:\n                    alert_id = alert['id']\n        return alert_id\n    except Exception as e:\n        raise Exception(\"Failed to get ransomware alert id from Helios, \" + str(e))\n\n\ndef main(args):\n    try:\n        alert_id = get_ransomware_alert_id(args)\n        if not alert_id:\n            raise Exception(\"Failed to find the anomalous object \"\n                            + args.object + \" on Helios\")\n        url = 'https://helios.cohesity.com/mcm/alerts/' + alert_id\n        headers = {'Content-Type': 'application/json', 'apiKey': args.helios_api_key}\n        request_payload = {\n            \"status\": \"kSuppressed\"\n        }\n        response = requests.patch(url, headers=headers, json=request_payload, verify=False)\n        if response.status_code != 200:\n            raise Exception('Failed to ignore anomaly on Helios ' + str(response.json()))\n        print(\"Workflow succeeded\")\n    except Exception as e:\n        sys.exit(str(e))\n\n\nparser = argparse.ArgumentParser(\n    description=\"Arguments to ignore anomaly on Helios\")\nparser.add_argument(\"helios_api_key\", help=\"Cohesity Helios API key\")\nparser.add_argument(\"object\", help=\"Anomalous object name\")\nargs = parser.parse_args()\nmain(args)",
          "script_arguments": [
            "$global.variable_01NUXTVON1RN738uyknMjBaKMXOjdk9up4r.global.variable_01NUXTVON1RN738uyknMjBaKMXOjdk9up4r$",
            "$workflow.definition_workflow_01OD1PCL0RXV10LyYf5QU9kVYA888BhHJR6.input.variable_workflow_01OD1SN9NY7FN7XM9qE2366Epc9DOwkVskF$"
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      }
    ],
    "categories": [
      "category_01FM7CGPZZCMY0KcvgiGjVH5UaB4y4aDJ7m"
    ]
  },
  "categories": {
    "category_01FM7CGPZZCMY0KcvgiGjVH5UaB4y4aDJ7m": {
      "unique_name": "category_01FM7CGPZZCMY0KcvgiGjVH5UaB4y4aDJ7m",
      "name": "response",
      "title": "response",
      "type": "basic.category",
      "base_type": "category",
      "category_type": "custom",
      "object_type": "category"
    }
  },
  "variables": {
    "variable_01NUXTVON1RN738uyknMjBaKMXOjdk9up4r": {
      "unique_name": "variable_01NUXTVON1RN738uyknMjBaKMXOjdk9up4r",
      "properties": {
        "value": "*****",
        "scope": "global",
        "name": "Helios API Key",
        "type": "datatype.secure_string",
        "is_required": false,
        "is_invisible": false
      },
      "object_type": "variable"
    }
  }
}